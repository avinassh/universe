<code-pad line=156 language="javascript" code="Y29uc3QgYXR0cmlidXRlcyA9IFsgImNvZGUiIF07CgpmdW5jdGlvbiBiYXNlNjREZWNvZGUoc3RyKSB7CiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGF0b2Ioc3RyKS5zcGxpdCgnJykubWFwKGZ1bmN0aW9uKGMpIHsKICAgICAgICByZXR1cm4gJyUnICsgKCcwMCcgKyBjLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMik7CiAgICB9KS5qb2luKCcnKSk7Cn0KCnRoaXMuc3RhdGVNYXBwZXJzID0gewogIGxpbmVzOiAoY29kZSkgPT4gewogICAgaWYgKCFjb2RlKSByZXR1cm4ge30KCiAgICBjb25zdCBvdXRwdXQgPSB7fTsKICAgIGxldCBsaW5lTnVtYmVyID0gMDsKICAgIGxldCBtb2RlbCA9IG5ldyBMYW5ndWFnZU1vZGVsKCk7CiAgICBmb3IoY29uc3QgbGluZSBvZiBiYXNlNjREZWNvZGUoY29kZSkuc3BsaXQoIlxuIikpIHsKICAgICAgb3V0cHV0W2xpbmVOdW1iZXJdID0ge307CiAgICAgIG91dHB1dFtsaW5lTnVtYmVyXS5saW5lTnVtYmVyID0gbGluZU51bWJlcjsKCiAgICAgIGlmKGxpbmVOdW1iZXIgPT0gMjAwKSBkZWJ1Z2dlcjsKCiAgICAgIGNvbnN0IGNvZGUgPSBtb2RlbC5leHRyYWN0U3ludGF4KGxpbmUpOwogICAgICB2YXIgaHRtbCA9IGNvZGUucmVwbGFjZSgvW1x1MDBBMC1cdTI2NjZdL2csIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgcmV0dXJuICcmIycrYy5jaGFyQ29kZUF0KDApKyc7JzsKICAgICAgfSk7CiAgICAgIG91dHB1dFtsaW5lTnVtYmVyXS5jb2RlID0gaHRtbDsKCiAgICAgIGxpbmVOdW1iZXIgKz0gMTsKICAgIH0KICAgIHJldHVybiBvdXRwdXQ7CiAgfQp9OwoKdGhpcy5zdGF0ZSA9IHsKICBsaW5lczogdGhpcy5zdGF0ZU1hcHBlcnMubGluZXModGhpcy5zdGF0ZS5jb2RlKSwKfTsKCi8vIFN5bnRheCBoaWdobGlnaHRpbmcKCmNsYXNzIExhbmd1YWdlTW9kZWwgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5saW5lID0gIiI7CiAgICB0aGlzLmluZGV4ID0gMDsKICAgIHRoaXMua2V5d29yZHMgPSBuZXcgU2V0KFsKICAgICAgJ2FzJywgJ2JyZWFrJywgJ2NvbnN0JywgJ2NvbnRpbnVlJywgJ2NyYXRlJywgJ2Vsc2UnLCAnZW51bScsICdleHRlcm4nLCAnZmFsc2UnLCAnZm4nLCAnZm9yJywgJ2lmJywgJ2ltcGwnLAogICAgICAnaW4nLCAnbGV0JywgJ2xvb3AnLCAnbWF0Y2gnLCAnbW9kJywgJ21vdmUnLCAnbXV0JywgJ3B1YicsICdyZWYnLCAncmV0dXJuJywgJ3NlbGYnLCAnU2VsZicsICdzdGF0aWMnLCAnc3RydWN0JywKICAgICAgJ3N1cGVyJywgJ3RyYWl0JywgJ3RydWUnLCAndHlwZScsICd1bnNhZmUnLCAndXNlJywgJ3doZXJlJywgJ3doaWxlJywgJ2FzeW5jJywgJ2F3YWl0JywgJ2R5bicsCiAgICAgICd1OCcsICd1MTYnLCAndTMyJywgJ3U2NCcsICd1MTI4JywgJ2k4JywgJ2kxNicsICdpMzInLCAnaTY0JywgJ2kxMjgnLCAnZjE2JywgJ2YzMicsICdmNjQnLCAnZjEyOCcKICAgIF0pOwogIH0KCiAgbmV4dCgpIHsKICAgIGNvbnN0IGNoID0gdGhpcy5wZWVrKCk7CiAgICB0aGlzLmluZGV4Kys7CiAgICByZXR1cm4gY2g7CiAgfQoKICBwZWVrKCkgewogICAgaWYodGhpcy5pbmRleCA+PSB0aGlzLmxpbmUubGVuZ3RoKSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0aGlzLmxpbmVbdGhpcy5pbmRleF07CiAgICB9CiAgfQoKICBpc1N0cmluZ0RlbGltaXRlcihjaCkgewogICAgcmV0dXJuIGNoID09ICdcJycgfHwgY2ggPT0gJyInIHx8IGNoID09ICdgJwogIH0KCiAgaXNDb21tZW50Q2hhcmFjdGVyKGNoKSB7CiAgICByZXR1cm4gY2ggPT0gJy8nIHx8IGNoID09ICcqJwogIH0KCiAgaXNJbnRlcm1pbmFibGVDb21tZW50KGNocykgewogICAgcmV0dXJuIGNocyA9PSAnLy8nCiAgfQoKICBpc0FscGhhbnVtZXJpYyhjaCkgewogICAgY29uc3QgY29kZSA9IGNoLmNoYXJDb2RlQXQoMCk7CiAgICBpZihjb2RlID49IDQ4ICYmIGNvZGUgPD0gNTcpIHJldHVybiB0cnVlOwogICAgaWYoY29kZSA+PSA5NyAmJiBjb2RlIDw9IDEyMikgcmV0dXJuIHRydWU7CiAgICBpZihjb2RlID49IDY1ICYmIGNvZGUgPD0gOTApIHJldHVybiB0cnVlOwoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHRha2VVbnRpbChkZWxpbWl0ZXIpIHsKICAgIGxldCBhY2MgPSAiIjsKICAgIGxldCBjaCA9IHRoaXMubmV4dCgpOwogICAgbGV0IGVzY2FwZWQgPSBmYWxzZTsKICAgIGxldCBsb29wcyA9IDA7CiAgICB3aGlsZShjaCAhPSAnJyAmJiBsb29wcyA8IDEwMCkgewogICAgICBsb29wcysrOwogICAgICBpZihjaCA9PSBkZWxpbWl0ZXIgJiYgIWVzY2FwZWQpIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgZXNjYXBlZCA9IGNoID09ICdcJyc7CiAgICAgIGFjYyArPSBjaDsKCiAgICAgIGNoID0gdGhpcy5uZXh0KCk7CiAgICB9CgogICAgcmV0dXJuIGFjYzsKICB9CgogIGV4dHJhY3RTeW50YXgobGluZSkgewogICAgdGhpcy5saW5lID0gbGluZTsKICAgIHRoaXMuaW5kZXggPSAwOwoKICAgIGxldCBvdXRwdXQgPSAiIjsKICAgIGxldCBjaCA9IHRoaXMubmV4dCgpOwogICAgbGV0IGxvb3BzID0gMDsKICAgIGxldCBhY2MgPSAiIjsKICAgIGxldCBjb21tZW50QWNjID0gIiI7CiAgICB3aGlsZShjaCAhPSAnJyAmJiBsb29wcyA8IDEwMCkgewogICAgICBsb29wcysrOwogICAgICBpZih0aGlzLmlzU3RyaW5nRGVsaW1pdGVyKGNoKSkgewogICAgICAgIGNvbnN0IHN0ciA9IHRoaXMudGFrZVVudGlsKGNoKTsKICAgICAgICBvdXRwdXQgKz0gYDxzcGFuIGNsYXNzPSdzdHInPiR7Y2h9JHtzdHJ9JHtjaH08L3NwYW4+YDsKICAgICAgICBjaCA9IHRoaXMubmV4dCgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZih0aGlzLmlzQ29tbWVudENoYXJhY3RlcihjaCkpIHsKICAgICAgICBjb21tZW50QWNjICs9IGNoOwogICAgICAgIGlmKHRoaXMuaXNJbnRlcm1pbmFibGVDb21tZW50KGNvbW1lbnRBY2MpKSB7CiAgICAgICAgICBsZXQgcmVtYWluZGVyID0gIiI7CiAgICAgICAgICBjaCA9IHRoaXMubmV4dCgpOwogICAgICAgICAgd2hpbGUoY2ggIT0gJycpIHsKICAgICAgICAgICAgY2ggPSB0aGlzLm5leHQoKTsKICAgICAgICAgICAgcmVtYWluZGVyICs9IGNoOwogICAgICAgICAgfQogICAgICAgICAgCiAgICAgICAgICBvdXRwdXQgKz0gYDxzcGFuIGNsYXNzPSdjb21tZW50Jz4ke2NvbW1lbnRBY2N9JHtyZW1haW5kZXJ9PC9zcGFuPmA7CiAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIGlmKGNvbW1lbnRBY2MubGVuZ3RoID4gMCkgewogICAgICAgIG91dHB1dCArPSBjb21tZW50QWNjOwogICAgICAgIGNvbW1lbnRBY2MgPSAiIjsKICAgICAgfQoKICAgICAgaWYodGhpcy5pc0FscGhhbnVtZXJpYyhjaCkpIHsKICAgICAgICBhY2MgKz0gY2g7CiAgICAgIH0gZWxzZSBpZihhY2MubGVuZ3RoID4gMCkgewogICAgICAgIGlmICh0aGlzLmtleXdvcmRzLmhhcyhhY2MpKSB7CiAgICAgICAgICBvdXRwdXQgKz0gYDxzcGFuIGNsYXNzPSdrZXl3b3JkJz4ke2FjY308L3NwYW4+JHtjaH1gOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvdXRwdXQgKz0gYWNjICsgY2g7CiAgICAgICAgfQogICAgICAgIGFjYyA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIG91dHB1dCArPSBjaDsKICAgICAgfQoKICAgICAgY2ggPSB0aGlzLm5leHQoKTsKICAgIH0KCiAgICByZXR1cm4gb3V0cHV0ICsgYWNjOwogIH0KfQo=" />
