events {
     worker_connections  4096;
}
http {

resolver 127.0.0.11 valid=30s;
client_max_body_size 50M;

server {
    listen 80;
    listen 443 ssl;
    server_name colinmerkel.xyz;
    ssl_certificate /cert/live/colinmerkel.xyz/cert.pem;
    ssl_certificate_key /cert/live/colinmerkel.xyz/privkey.pem;

    location / {
      proxy_set_header    Host $host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    X-Forwarded-Proto $scheme;

      set $homepage http://homepage:8080;
      proxy_pass          $homepage;
      proxy_read_timeout  90;

      proxy_redirect      $homepage https://colinmerkel.xyz;
    }
}
server {
    listen 8001 http2;
    server_name code.colinmerkel.xyz;
    http2_max_requests 100000000;
    http2_idle_timeout 30m;

    location / {
      grpc_pass grpc://weld:8001;
    }
}
server {
    listen 80;
    listen 443 ssl;
    server_name review.colinmerkel.xyz;
    ssl_certificate /cert/live/colinmerkel.xyz/cert.pem;
    ssl_certificate_key /cert/live/colinmerkel.xyz/privkey.pem;

    location / {
      proxy_set_header    Host $host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    X-Forwarded-Proto $scheme;

      set $review http://review:8080;
      proxy_pass          $review;
      proxy_read_timeout  90;

      proxy_redirect      http://review:8080 https://review.colinmerkel.xyz;
    }
}
server {
    listen 80;
    listen 443 ssl;
    server_name auth.colinmerkel.xyz;
    ssl_certificate /cert/live/colinmerkel.xyz/cert.pem;
    ssl_certificate_key /cert/live/colinmerkel.xyz/privkey.pem;

    location / {
      proxy_set_header    Host $host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    X-Forwarded-Proto $scheme;

      set $auth http://auth:8899;
      proxy_pass          $auth;
      proxy_read_timeout  90;
    }
}
server {
    listen 80;
    listen 443 ssl;
    server_name tasks.colinmerkel.xyz;
    ssl_certificate /cert/live/colinmerkel.xyz/cert.pem;
    ssl_certificate_key /cert/live/colinmerkel.xyz/privkey.pem;

    location / {
      proxy_set_header    Host $host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    X-Forwarded-Proto $scheme;

      proxy_pass          http://tasks:7878;
      proxy_read_timeout  90;

      proxy_redirect      http://tasks:7878 https://tasks.colinmerkel.xyz;
    }
}
server {
    listen 80;
    listen 443 ssl;
    server_name x20.colinmerkel.xyz;
    ssl_certificate /cert/live/colinmerkel.xyz/cert.pem;
    ssl_certificate_key /cert/live/colinmerkel.xyz/privkey.pem;

    location / {
      proxy_set_header    Host $host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    X-Forwarded-Proto $scheme;

      set $x20 http://x20_web:50000;
      proxy_pass          $x20;
      proxy_read_timeout  90;
    }
}
server {
    listen 8009 http2;
    server_name x20.colinmerkel.xyz;
    http2_max_requests 100000000;
    http2_idle_timeout 30m;

    location / {
      set $x20_grpc grpc://x20:8009;
      grpc_pass $x20_grpc;
    }
}
server {
    listen 8888 http2;
    server_name auth.colinmerkel.xyz;
    http2_max_requests 100000000;
    http2_idle_timeout 30m;

    location / {
      set $auth_grpc grpc://auth:8888;
      grpc_pass $auth_grpc;
    }
}
server {
    listen 9999 http2;
    server_name bugs.colinmerkel.xyz;
    http2_max_requests 100000000;
    http2_idle_timeout 30m;

    location / {
      set $bugs_grpc grpc://bugs:9999;
      grpc_pass $bugs_grpc;
    }
}
server {
    listen 80;
    listen 443 ssl;
    server_name search.colinmerkel.xyz;
    ssl_certificate /cert/live/colinmerkel.xyz/cert.pem;
    ssl_certificate_key /cert/live/colinmerkel.xyz/privkey.pem;

    location / {
      proxy_set_header    Host $host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header    X-Forwarded-Proto $scheme;

      set $search http://search_server:50001;
      proxy_pass          $search;
      proxy_read_timeout  90;
    }
}
server {
    listen 50002 http2;
    server_name search.colinmerkel.xyz;
    http2_max_requests 100000000;
    http2_idle_timeout 30m;

    location / {
      set $search_grpc grpc://search_server:50002;
      grpc_pass $search_grpc;
    }
}
}
